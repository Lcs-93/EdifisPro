{% extends 'base.html.twig' %}

{% block body %}
    <div class="container mt-5 d-flex justify-content-center">
        <div class="card glassmorphism-card shadow-lg p-4">
            <h1 class="text-center text-primary mb-4">ðŸš€ CrÃ©er une Ã‰quipe</h1>
            <button class="btn btn-light mb-3" id="toggleDetails">Afficher/Masquer dÃ©tails</button>
            <div id="detailsSection">
                {{ form_start(form) }}

                <!-- Nom de l'Ã©quipe -->
                <div class="mb-4">
                    {{ form_label(form.nomEquipe, 'Nom de l\'Ã©quipe', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.nomEquipe, {'attr': {'class': 'form-control custom-input'}}) }}
                </div>

                <!-- SÃ©lection du Chef d'Ã©quipe (Avec Recherche) -->
                <div class="mb-4">
                    {{ form_label(form.chefEquipe, 'Chef d\'Ã©quipe', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.chefEquipe, {'attr': {'class': 'form-select custom-input'}}) }}
                </div>

                <!-- SÃ©lection rapide par service -->
                <h3 class="mt-4 text-secondary fw-bold">ðŸ‘¥ Ajouter des membres :</h3>
                <select id="selectService" class="form-select">
                    <option value="">SÃ©lectionner un service...</option>
                    <option value="technique">Service Technique</option>
                    <option value="logistique">Service Logistique</option>
                </select>
                <button class="btn btn-secondary mt-2" id="addServiceMembers">Ajouter ces membres</button>

                <!-- Membres de l'Ã©quipe avec Recherche -->
                <input type="text" id="searchMembre" class="form-control mb-3" placeholder="Rechercher un membre...">
                <div class="card p-3 mb-3 glassmorphism-subcard">
                    <div class="row">
                        {% for membre in form.membres %}
                            <div class="col-md-4 mb-2">
                                <div class="form-check custom-checkbox"
                                     {% if membre.vars.attr.service is defined %} data-service="{{ membre.vars.attr.service }}" {% endif %}>
                                    {{ form_widget(membre, {'attr': {'class': 'form-check-input'}}) }}
                                    {{ form_label(membre, null, {'label_attr': {'class': 'form-check-label'}}) }}
                                    {{ form_errors(membre) }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Dates d'affectation -->
                <h3 class="mt-4 text-secondary fw-bold">ðŸ“… Dates d'affectation :</h3>
                <button class="btn btn-outline-primary mt-2" id="autoDates">SuggÃ©rer des dates</button>
                <div class="card p-3 mb-3 glassmorphism-subcard">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form_label(form.dateDebut, 'Date de DÃ©but', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.dateDebut, {'attr': {'class': 'form-control custom-input'}}) }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form_label(form.dateFin, 'Date de Fin', {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.dateFin, {'attr': {'class': 'form-control custom-input'}}) }}
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-glass btn-lg">
                        <i class="fas fa-save"></i> CrÃ©er l'Ã‰quipe
                    </button>
                </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        $("#equipe_chefEquipe").select2({
            placeholder: "SÃ©lectionner un chef d'Ã©quipe",
            allowClear: true
        });

        document.getElementById("toggleDetails").addEventListener("click", function() {
            let section = document.getElementById("detailsSection");
            section.style.display = (section.style.display === "none") ? "block" : "none";
        });

        document.getElementById("searchMembre").addEventListener("keyup", function() {
            let searchValue = this.value.toLowerCase();
            document.querySelectorAll(".custom-checkbox").forEach(check => {
                let label = check.querySelector("label").textContent.toLowerCase();
                check.style.display = label.includes(searchValue) ? "block" : "none";
            });
        });

        document.getElementById("addServiceMembers").addEventListener("click", function() {
            let service = document.getElementById("selectService").value;
            document.querySelectorAll(".custom-checkbox").forEach(check => {
                if (check.dataset.service === service) {
                    check.querySelector("input").checked = true;
                }
            });
        });

        document.getElementById("autoDates").addEventListener("click", function() {
            let today = new Date().toISOString().split("T")[0];
            let endDate = new Date();
            endDate.setFullYear(endDate.getFullYear() + 1);
            document.getElementById("equipe_dateDebut").value = today;
            document.getElementById("equipe_dateFin").value = endDate.toISOString().split("T")[0];
        });
    });
    </script>

    <style>
        @media (max-width: 768px) {
            .glassmorphism-card {
                width: 100%;
                max-width: 90%;
            }
        }
    </style>
{% endblock %}
